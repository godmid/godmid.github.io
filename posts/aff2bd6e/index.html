<!DOCTYPE html><html lang="en,zh_CN"><head><!-- hexo injector head_begin start --><link href="https://cdn.jsdelivr.net/npm/hexo-tag-common@latest/css/index.css" rel="stylesheet"/><!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="DarkFox"><meta name="copyright" content="DarkFox"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>陀螺仪--mpu6050 | 冥狐的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.24/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_ed8vp4atwoj.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});
</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.css"><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/auto-render.min.js"></script><script>document.addEventListener("DOMContentLoaded", function() {
  renderMathInElement(document.body, {
    delimiters: [
      {left: "$$", right: "$$", display: true},
      {left: "$", right: "$", display: false},
      {left: "\\(", right: "\\)", display: false},
      {left: "\\[", right: "\\]", display: true}
    ]
  });
});</script><script src="https://cdn.jsdelivr.net/npm/pjax@latest/pjax.min.js" defer></script><script src="/js/pjax.js" defer></script><script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script><link rel="shortcut icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"www.darkfox.top","root":"/","title":"冥狐的小站","version":"1.5.1","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}.","hits":"${hits} results found","hits_time":"${hits} results found in ${time} ms"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"local_search":{"path":"/search.xml"},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="alternate" href="/atom.xml" title="冥狐的小站" type="application/atom+xml"><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><meta name="description" content="Ⅰ.陀螺仪 陀螺仪是用高速回转体的动量矩敏感壳体相对惯性空间绕正交于自转轴的一个或二个轴的角运动检测装置。利用其他原理制成的角运动检测装置起同样功能的也称陀螺仪。 从力学的观点近似的分析陀螺的运动时，可以把它看成是一个刚体，刚体上有一个万向支点，而陀螺可以绕着这个支点作三个自由度的转动，所以陀螺的运动是属于刚体绕一个定点的转动运动。更确切地说，一个绕对称铀高速旋转的飞轮转子叫陀螺。将陀螺安装在框">
<meta property="og:type" content="article">
<meta property="og:title" content="陀螺仪--mpu6050">
<meta property="og:url" content="https://www.darkfox.top/posts/aff2bd6e/index.html">
<meta property="og:site_name" content="冥狐的小站">
<meta property="og:description" content="Ⅰ.陀螺仪 陀螺仪是用高速回转体的动量矩敏感壳体相对惯性空间绕正交于自转轴的一个或二个轴的角运动检测装置。利用其他原理制成的角运动检测装置起同样功能的也称陀螺仪。 从力学的观点近似的分析陀螺的运动时，可以把它看成是一个刚体，刚体上有一个万向支点，而陀螺可以绕着这个支点作三个自由度的转动，所以陀螺的运动是属于刚体绕一个定点的转动运动。更确切地说，一个绕对称铀高速旋转的飞轮转子叫陀螺。将陀螺安装在框">
<meta property="og:locale">
<meta property="og:image" content="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/img/20140401183456562">
<meta property="og:image" content="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/img/20140401183518578">
<meta property="og:image" content="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/img/20140401183525562">
<meta property="og:image" content="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/img/20140401183537890">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527164308375.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527152447545.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527153154426.jpg#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527154441137.jpg#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527154625454.jpg#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527154801757.jpg#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527160414156.jpg#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527160935948.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527162315369.jpg#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527162507349.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/2021052716305611.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527163838510.jpg#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527164235503.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527171530241.jpg#pic_center">
<meta property="og:image" content="https://img-blog.csdnimg.cn/20210527174024629.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center">
<meta property="article:published_time" content="2021-07-27T13:49:10.000Z">
<meta property="article:modified_time" content="2021-08-20T10:23:04.936Z">
<meta property="article:author" content="DarkFox">
<meta property="article:tag" content="learn,blog,冥狐，小站">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/img/20140401183456562"><script src="/js/ui/mode.js"></script><link href="https://cdn.bootcss.com/KaTeX/0.11.1/katex.min.css" rel="stylesheet" /></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><canvas id="trianglifyContainer"></canvas><script defer src="https://cdn.jsdelivr.net/npm/trianglify@4/dist/trianglify.bundle.js"></script><script>document.addEventListener("DOMContentLoaded", () => {
  const pattern = trianglify({
    width: 800,
    height: 600,
    cellSize: 75,
    palette: ["YlGnBu", "GnBu", "Purples", "Blues"],
  });
  const canvasOpts = {
    applyCssScaling: false
  }
  document.body.appendChild(pattern.toCanvas(trianglifyContainer, canvasOpts));
});</script><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="Table of Contents"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="Overview"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="DarkFox"><img width="96" loading="lazy" src="/Yun.png" alt="DarkFox"><span class="site-author-status" title="永远相信美好的事情即将发生">😎</span></a><div class="site-author-name"><a href="/about/">DarkFox</a></div><a class="site-name" href="/about/site.html">冥狐的小站</a><sub class="site-subtitle">如无必要，勿增实体</sub><div class="site-desciption">记录每一次的感动</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="Home"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="Archives"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">68</span></a></div><div class="site-state-item"><a href="/categories/" title="Categories"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">14</span></a></div><div class="site-state-item"><a href="/tags/" title="Tags"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">27</span></a></div><a class="site-state-item hty-icon-button" href="/albums/" title="相册"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-gallery-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://user.qzone.qq.com/494752893/infocenter" title="QQ 494752893" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/godmid" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=543569056" title="网易云音乐" target="_blank" style="color:#C20C0C"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.zhihu.com/people/hei-hu-dark-fox-85" title="知乎" target="_blank" style="color:#0084FF"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-zhihu-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/89657746" title="哔哩哔哩" target="_blank" style="color:#FF8EB3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:darkfoxx@qq.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a><a class="links-item hty-icon-button" href="/girls/" title="漂亮的女孩" style="color:hotpink"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-women-line"></use></svg></a><a class="links-item hty-icon-button" href="/tools/" title="小工具" style="color:black"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-pushpin-line"></use></svg></a><a class="links-item hty-icon-button" href="/website/" title="站点分享" style="color:black"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">Ⅰ.陀螺仪</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">Ⅱ.MPU6050模块</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">3.硬件连接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">4.软件代码————官方自带库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">5.软件代码————其他代码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">6.学习补充</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">7.效果展示(可以先来看这个)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">8.参考链接</span></a></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">9.完整版代码链接</span></a></li></ol></div></div></div><div class="tag-cloud"><div class="tag-cloud-tags"><a href="/tags/AD/" style="font-size: 12px; color: #999">AD</a> <a href="/tags/AD-learning-video/" style="font-size: 12px; color: #999">AD_learning_video</a> <a href="/tags/Fox-saying/" style="font-size: 12px; color: #999">Fox saying</a> <a href="/tags/MISC/" style="font-size: 24px; color: #3383cd">MISC</a> <a href="/tags/arduino/" style="font-size: 12px; color: #999">arduino</a> <a href="/tags/bug/" style="font-size: 24px; color: #3383cd">bug</a> <a href="/tags/code/" style="font-size: 12px; color: #999">code</a> <a href="/tags/c%E8%AF%AD%E8%A8%80%E5%88%9D%E6%AD%A5%E5%AD%A6%E4%B9%A0/" style="font-size: 24px; color: #3383cd">c语言初步学习</a> <a href="/tags/fun/" style="font-size: 24px; color: #3383cd">fun</a> <a href="/tags/idea/" style="font-size: 12px; color: #999">idea</a> <a href="/tags/openmv/" style="font-size: 12px; color: #999">openmv</a> <a href="/tags/stm32/" style="font-size: 12px; color: #999">stm32</a> <a href="/tags/stm32%E8%B5%84%E6%96%99/" style="font-size: 24px; color: #3383cd">stm32资料</a> <a href="/tags/video/" style="font-size: 30px; color: #0078e7">video</a> <a href="/tags/%E4%BC%AA%E4%BB%A3%E7%A0%81/" style="font-size: 18px; color: #668eb3">伪代码</a> <a href="/tags/%E5%A4%8D%E5%8F%98%E5%87%BD%E6%95%B0/" style="font-size: 12px; color: #999">复变函数</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E6%96%B9%E6%B3%95/" style="font-size: 12px; color: #999">学习方法</a> <a href="/tags/%E5%BC%80%E6%BA%90/" style="font-size: 12px; color: #999">开源</a> <a href="/tags/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/" style="font-size: 18px; color: #668eb3">微机原理</a> <a href="/tags/%E6%95%B0%E5%AD%A6/" style="font-size: 24px; color: #3383cd">数学</a></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://www.darkfox.top/posts/aff2bd6e/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="DarkFox"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="冥狐的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">陀螺仪--mpu6050</h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <span class="post-meta-icon-text">Posted on</span> <time title="Created: 2021-07-27 21:49:10" itemprop="dateCreated datePublished" datetime="2021-07-27T21:49:10+08:00">2021-07-27</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <span class="post-meta-icon-text">Edited on</span> <time title="Modified: 2021-08-20 18:23:04" itemprop="dateModified" datetime="2021-08-20T18:23:04+08:00">2021-08-20</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="Word count in article"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="Word count in article">6.6k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Reading time"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="Reading time">26m</span></span></span><span class="post-busuanzi"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="Views"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span id="busuanzi_value_page_pv"></span></span></span><div class="post-classify"></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><span id="more"></span>
<h1>Ⅰ.陀螺仪</h1>
<p>陀螺仪是用高速回转体的动量矩敏感壳体相对惯性空间绕正交于自转轴的一个或二个轴的角运动检测装置。利用其他原理制成的角运动检测装置起同样功能的也称陀螺仪。<br>
从力学的观点近似的分析陀螺的运动时，可以把它看成是一个刚体，刚体上有一个万向支点，而陀螺可以绕着这个支点作三个自由度的转动，所以陀螺的运动是属于刚体绕一个定点的转动运动。更确切地说，一个绕对称铀高速旋转的飞轮转子叫陀螺。将陀螺安装在框架装置上，使陀螺的自转轴有角转动的自由度，这种装置的总体叫做陀螺仪。<br>
陀螺仪的原理就是，一个旋转物体的旋转轴所指的方向在不受外力影响时，是不会改变的。人们根据这个道理，用它来保持方向，制造出来的东西就叫陀螺仪。我们骑自行车其实也是利用了这个原理。轮子转得越快越不容易倒，因为车轴有一股保持水平的力量。陀螺仪在工作时要给它一个力，使它快速旋转起来，一般能达到每分钟几十万转，可以工作很长时间。然后用多种方法读取轴所指示的方向，并自动将数据信号传给控制系统。</p>
<h1>Ⅱ.MPU6050模块</h1>
<p>简介：<br>
MPU6050内部整合了<strong>三轴MEMS陀螺仪</strong>、<strong>三轴MEMS加速度计</strong>以及一个可扩展的<strong>数字运动处理器DMP(Digital Motion Processor)</strong>，而且还可以连接一个第三方数字传感器(如磁力计)，这样的话，就可以通过IIC接口输出一个9轴信号(链接第三方数字传感器才可以输出九轴信号，否则只有六轴信号)。更加方便的是，有了DMP，可以结合InvenSense公司提供的运动处理资料库，实现姿态解算。通过自带的DMP，可以通过<strong>IIC接口</strong>输出9轴融合演算的数据，大大降低了运动处理运算对操作系统的负荷，同时也降低了开发难度。<em><strong>其实，简单一句话说，陀螺仪就是测角速度的，加速度传感器就是测角加速度的，二者数据通过算法就可以得到PITCH、YAW、ROLL角了。</strong></em></p>
<p><img src="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/img/20140401183456562" alt="右手笛卡尔坐标系" loading="lazy"></p>
<p><img src="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/img/20140401183518578" alt="img" loading="lazy"></p>
<p><img src="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/img/20140401183525562" alt="img" loading="lazy"></p>
<p><img src="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/img/20140401183537890" alt="img" loading="lazy"></p>
<p>特点：</p>
<ol>
<li>以数字形式输出 6 轴或 9 轴（需外接磁传感器）的旋转矩阵、四元数(quaternion)、欧拉角格式(Euler Angle forma)的融合演算数据（需 DMP 支持）</li>
<li>具有 131 LSBs/° /sec 敏感度与全格感测范围为±250、±500、±1000 与±2000° /sec的 3 轴角速度感测器(陀螺仪)</li>
<li>集成可程序控制，范围为±2g、±4g、±8g 和±16g 的 3 轴加速度传感器</li>
<li>移除加速器与陀螺仪轴间敏感度，降低设定给予的影响与感测器的飘移</li>
<li>自带数字运动处理(DMP: Digital Motion Processing)引擎可减少 MCU 复杂的融合演算数据、感测器同步化、姿势感应等的负荷</li>
<li>内建运作时间偏差与磁力感测器校正演算技术，免除了客户须另外进行校正的需求</li>
<li>自带一个数字温度传感器</li>
<li>带数字输入同步引脚(Sync pin)支持视频电子影相稳定技术与 GPS</li>
<li>可程序控制的中断(interrupt)，支持姿势识别、摇摄、画面放大缩小、滚动、快速下降中断、 high-G 中断、零动作感应、触击感应、摇动感应功能</li>
<li>VDD 供电电压为 2.5V±5%、 3.0V±5%、 3.3V±5%； VLOGIC 可低至 1.8V± 5%</li>
<li>陀螺仪工作电流： 5mA，陀螺仪待机电流： 5uA； 加速器工作电流：500uA，加速器省电模式电流： 40uA@10Hz</li>
<li>自带 1024 字节 FIFO，有助于降低系统功耗</li>
<li>高达 400Khz 的 IIC 通信接口</li>
<li>超小封装尺寸： 4x4x0.9mm（QFN）</li>
</ol>
<p>MPU6050三轴角(姿态角)<br>
<img src="https://img-blog.csdnimg.cn/20210527164308375.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
<strong>绕向即为正方向，可根据右手螺旋定则确定方向。</strong><br>
MPU6050框图：<br>
<img src="https://img-blog.csdnimg.cn/20210527152447545.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" loading="lazy">可以很清晰地观察到，MPU6050芯片中内置了三轴加速度传感器、三轴陀螺仪和一个温度传感器。右侧INT为中断输出脚，TCS为片选脚、AD0为设置地址脚、SCL和SDA为主IIC接口、AUX_CL和AUX_DA为从IIC接口，主要用到的是AD0、SCL、SDA。</p>
<p>相关寄存器(想深入了解的朋友可以看一下)结合后面的代码更容易理解一些<br>
①<br>
<img src="https://img-blog.csdnimg.cn/20210527153154426.jpg#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
DEVICE_RESE=1，复位MPU6050，复位完成后，自动清零。SLEEP=1，进入睡眠模式；SLEEP=0，正常工作模式。TEMP_DIS，用于设置是否使能温度传感器，设置为0，则使能CLKSEL[2:0]，用于选择系统时钟源，如下所示：</p>
<table>
<thead>
<tr>
<th>CLKSEL[2:0]</th>
<th>时钟源</th>
</tr>
</thead>
<tbody>
<tr>
<td>001</td>
<td>内部8M RC晶振</td>
</tr>
<tr>
<td>010</td>
<td>PLL，使用X轴陀螺作为参考</td>
</tr>
<tr>
<td>011</td>
<td>PLL，使用Y轴陀螺作为参考</td>
</tr>
<tr>
<td>100</td>
<td>PLL，使用Z轴陀螺作为参考</td>
</tr>
<tr>
<td>101</td>
<td>PLL，使用外部32.768Khz作为参考</td>
</tr>
<tr>
<td>110</td>
<td>PLL，使用外部19.2Mhz作为参考</td>
</tr>
<tr>
<td>11</td>
<td>保留</td>
</tr>
<tr>
<td>001</td>
<td>关闭时钟，保持时序产生电路复位状态</td>
</tr>
</tbody>
</table>
<p>总之，电源管理寄存器就是复位MPU6050<br>
②<br>
<img src="https://img-blog.csdnimg.cn/20210527154441137.jpg#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
该寄存器我们只关心FS_SEL[1:0]这两个位，用于设置陀螺仪的满量程范围：0，±250°/s；1，±500°/s；2，±1000°/s；3，±2000°/s；我们一般设置为3，即±2000°/S，因为陀螺仪的ADC为16位分辨率，所以得到灵敏度为：65536/4000=16.4LSB/(°/S)。<br>
总之，陀螺仪配置寄存器就是配置陀螺仪满量程范围，设置最大<br>
③<br>
<img src="https://img-blog.csdnimg.cn/20210527154625454.jpg#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
该寄存器我们只关心AFS_SEL[1:0]这两个位，用于设置加速度传感器的满量程范围：0，±2g；1，±4g；2，±8g；3，±16g；我们一般设置为0，即±2g，因为加速度传感器的ADC也是16位，所以得到灵敏度为：65536/4=16384LSB/g。<br>
总之，加速度传感器配置寄存器就是配置加速度传感器满量程范围，不宜过大<br>
④<br>
<img src="https://img-blog.csdnimg.cn/20210527154801757.jpg#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
该寄存器用于控制FIFO使能，在简单读取传感器数据的时候，可以不用FIFO，设置对应位为：0，即可禁止FIFO，设置为1，则使能FIFO。加速度传感器的三个轴，全由一个位(ACCEL_FIFO_EN)控制，只要该位为1，则加速度传感器三个通道都开启FIFO；但是陀螺仪传感器的三个轴需要一个一个设置，即XYZ轴分别配置。<br>
总之，FIFO使能寄存器用于控制使能FIFO(First Input First Output)<br>
⑤<br>
<img src="https://img-blog.csdnimg.cn/20210527160414156.jpg#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
该寄存器用于设置MPU6050的陀螺仪采样频率，计算公式为：<strong>采样频率 = 陀螺仪输出频率 / (1+SMPLRT_DIV)</strong>。这里陀螺仪的输出频率，是1Khz或者8Khz，与数字低通滤波器（DLPF）的设置有关，当DLPF_CFG=0或7的时候，频率为8Khz，其他情况是1Khz。而且DLPF滤波频率一般设置为采样率的一半。采样率，我们假定设置为50Hz，那么：SMPLRT_DIV=1000/50-1=19。<br>
总之，陀螺仪采样率分频寄存器就是用于设置陀螺仪的采样频率，如果采样频率为50Hz，那么采样周期就为1/50=20ms，即20ms采集一次陀螺仪的数据。<br>
⑥<br>
<img src="https://img-blog.csdnimg.cn/20210527160935948.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
总之，配置寄存器就是设置数字低通滤波器的DLPF_CFG位来结合陀螺仪采样分频寄存器来共同设置采样周期。<br>
⑦<br>
<img src="https://img-blog.csdnimg.cn/20210527162315369.jpg#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
该寄存器的LP_WAKE_CTRL用于控制低功耗时的唤醒频率，用不到。剩下的6位，分别控制加速度和陀螺仪的x/y/z轴是否进入待机模式，这里我们全部都不进入待机模式，所以全部设置为：0 ，即可。<br>
总之，电源管理寄存器2就是用于设置加速度传感器和陀螺仪的X/Y/Z轴是进入休眠还是正常工作。<br>
⑧<img src="https://img-blog.csdnimg.cn/20210527162507349.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
加速度传感器数据输出寄存器总共由6个寄存器组成，输出X/Y/Z三个轴的加速度传感器值，高字节在前，低字节在后。<br>
总之，加速度传感器数据输出寄存器就是把加速度传感器测量到的数据输出出来。<br>
⑨<br>
<img src="https://img-blog.csdnimg.cn/2021052716305611.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
陀螺仪数据输出寄存器总共由6个寄存器组成，输出X/Y/Z三个轴的陀螺仪传感器数据，高字节在前，低字节在后。<br>
总之，陀螺仪数据输出寄存器就是把陀螺仪测量到的数据输出出来。<br>
⑩<br>
<img src="https://img-blog.csdnimg.cn/20210527163838510.jpg#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
通过读取0X41（高8位）和0X42（低8位）寄存器得到，温度换算公式为：<br>
Temperature = 36.53 + regval/340。其中，Temperature为计算得到的温度值，单位为℃，regval为从0X41和0X42读到的温度传感器值。<br>
总之，温度传感器数据输出寄存器就是把温度寄存器测量到的数据处处出来。</p>
<h1>3.硬件连接</h1>
<p><img src="https://img-blog.csdnimg.cn/20210527164235503.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
<strong>VCC</strong>:接5V电源<br>
<strong>GND</strong>:接地<br>
<strong>SCL</strong>:主IIC时钟线 (我接的PB10)<br>
<strong>SDA</strong>:主IIC数据线 (我接的PB11)<br>
<strong>AD0</strong>:地址线，接3V地址为0x68，接地地址为0x69（我接的PA15，高电平，地址为0x68）</p>
<h1>4.软件代码————官方自带库</h1>
<p>MPU6050处理寄存器的相关数据时需要移植几个官方库，以便将数据处理为所需要的欧拉角。正点原子共提供了五个源码，如下图：<br>
<img src="https://img-blog.csdnimg.cn/20210527171530241.jpg#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
这些是需要在写MPU6050代码之前移植过来的，具体代码内容大家可以下载下方源码查看。</p>
<h1>5.软件代码————其他代码</h1>
<p>MPU6050.h<br>
<strong>主要宏定义一些MPU6050寄存器的地址，方便IIC发送给寄存器数据初始化MPU6050。</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __MPU6050_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __MPU6050_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;mpuiic.h&quot;</span>   												  	  </span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//MPU6050 AD0控制脚</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_AD0_CTRL			PAout(15)	<span class="comment">//控制AD0电平,从而控制MPU地址</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//#define MPU_ACCEL_OFFS_REG		0X06	//accel_offs寄存器,可读取版本号,寄存器手册未提到</span></span><br><span class="line"><span class="comment">//#define MPU_PROD_ID_REG			0X0C	//prod id寄存器,在寄存器手册未提到</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_SELF_TESTX_REG		0X0D	<span class="comment">//自检寄存器X</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_SELF_TESTY_REG		0X0E	<span class="comment">//自检寄存器Y</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_SELF_TESTZ_REG		0X0F	<span class="comment">//自检寄存器Z</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_SELF_TESTA_REG		0X10	<span class="comment">//自检寄存器A</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_SAMPLE_RATE_REG		0X19	<span class="comment">//采样频率分频器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_CFG_REG						0X1A	<span class="comment">//配置寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_GYRO_CFG_REG			0X1B	<span class="comment">//陀螺仪配置寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_ACCEL_CFG_REG			0X1C	<span class="comment">//加速度计配置寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_MOTION_DET_REG		0X1F	<span class="comment">//运动检测阀值设置寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_FIFO_EN_REG				0X23	<span class="comment">//FIFO使能寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CMST_CTRL_REG		0X24	<span class="comment">//IIC主机控制寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV0_ADDR_REG	0X25	<span class="comment">//IIC从机0器件地址寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV0_REG				0X26	<span class="comment">//IIC从机0数据地址寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV0_CTRL_REG	0X27	<span class="comment">//IIC从机0控制寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV1_ADDR_REG	0X28	<span class="comment">//IIC从机1器件地址寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV1_REG				0X29	<span class="comment">//IIC从机1数据地址寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV1_CTRL_REG	0X2A	<span class="comment">//IIC从机1控制寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV2_ADDR_REG	0X2B	<span class="comment">//IIC从机2器件地址寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV2_REG				0X2C	<span class="comment">//IIC从机2数据地址寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV2_CTRL_REG	0X2D	<span class="comment">//IIC从机2控制寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV3_ADDR_REG	0X2E	<span class="comment">//IIC从机3器件地址寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV3_REG				0X2F	<span class="comment">//IIC从机3数据地址寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV3_CTRL_REG	0X30	<span class="comment">//IIC从机3控制寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV4_ADDR_REG	0X31	<span class="comment">//IIC从机4器件地址寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV4_REG				0X32	<span class="comment">//IIC从机4数据地址寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV4_DO_REG		0X33	<span class="comment">//IIC从机4写数据寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV4_CTRL_REG	0X34	<span class="comment">//IIC从机4控制寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV4_DI_REG		0X35	<span class="comment">//IIC从机4读数据寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CMST_STA_REG		0X36	<span class="comment">//IIC主机状态寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_INTBP_CFG_REG			0X37	<span class="comment">//中断/旁路设置寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_INT_EN_REG				0X38	<span class="comment">//中断使能寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_INT_STA_REG				0X3A	<span class="comment">//中断状态寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_ACCEL_XOUTH_REG		0X3B	<span class="comment">//加速度值,X轴高8位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_ACCEL_XOUTL_REG		0X3C	<span class="comment">//加速度值,X轴低8位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_ACCEL_YOUTH_REG		0X3D	<span class="comment">//加速度值,Y轴高8位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_ACCEL_YOUTL_REG		0X3E	<span class="comment">//加速度值,Y轴低8位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_ACCEL_ZOUTH_REG		0X3F	<span class="comment">//加速度值,Z轴高8位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_ACCEL_ZOUTL_REG		0X40	<span class="comment">//加速度值,Z轴低8位寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_TEMP_OUTH_REG			0X41	<span class="comment">//温度值高八位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_TEMP_OUTL_REG			0X42	<span class="comment">//温度值低8位寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_GYRO_XOUTH_REG		0X43	<span class="comment">//陀螺仪值,X轴高8位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_GYRO_XOUTL_REG		0X44	<span class="comment">//陀螺仪值,X轴低8位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_GYRO_YOUTH_REG		0X45	<span class="comment">//陀螺仪值,Y轴高8位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_GYRO_YOUTL_REG		0X46	<span class="comment">//陀螺仪值,Y轴低8位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_GYRO_ZOUTH_REG		0X47	<span class="comment">//陀螺仪值,Z轴高8位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_GYRO_ZOUTL_REG		0X48	<span class="comment">//陀螺仪值,Z轴低8位寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV0_DO_REG		0X63	<span class="comment">//IIC从机0数据寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV1_DO_REG		0X64	<span class="comment">//IIC从机1数据寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV2_DO_REG		0X65	<span class="comment">//IIC从机2数据寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CSLV3_DO_REG		0X66	<span class="comment">//IIC从机3数据寄存器</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_I2CMST_DELAY_REG	0X67	<span class="comment">//IIC主机延时管理寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_SIGPATH_RST_REG		0X68	<span class="comment">//信号通道复位寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_MDETECT_CTRL_REG	0X69	<span class="comment">//运动检测控制寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_USER_CTRL_REG			0X6A	<span class="comment">//用户控制寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_PWR_MGMT1_REG			0X6B	<span class="comment">//电源管理寄存器1</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_PWR_MGMT2_REG			0X6C	<span class="comment">//电源管理寄存器2 </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_FIFO_CNTH_REG			0X72	<span class="comment">//FIFO计数寄存器高八位</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_FIFO_CNTL_REG			0X73	<span class="comment">//FIFO计数寄存器低八位</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_FIFO_RW_REG				0X74	<span class="comment">//FIFO读写寄存器</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_DEVICE_ID_REG			0X75	<span class="comment">//器件ID寄存器</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//如果AD0脚(9脚)接地,IIC地址为0X68(不包含最低位).</span></span><br><span class="line"><span class="comment">//如果接V3.3,则IIC地址为0X69(不包含最低位).</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_ADDR							0X68</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//因为模块AD0默认接GND,所以转为读写地址后,为0XD1和0XD0(如果接VCC,则为0XD3和0XD2)  </span></span><br><span class="line"><span class="comment">//#define MPU_READ    				0XD1</span></span><br><span class="line"><span class="comment">//#define MPU_WRITE   				0XD0</span></span><br><span class="line"></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Init</span><span class="params">(<span class="keyword">void</span>)</span></span>; 															<span class="comment">//初始化MPU6050</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Write_Len</span><span class="params">(u8 addr,u8 reg,u8 len,u8 *buf)</span></span>;<span class="comment">//IIC连续写</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Read_Len</span><span class="params">(u8 addr,u8 reg,u8 len,u8 *buf)</span></span>; <span class="comment">//IIC连续读 </span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Write_Byte</span><span class="params">(u8 reg,u8 data)</span></span>;							<span class="comment">//IIC写一个字节</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Read_Byte</span><span class="params">(u8 reg)</span></span>;												<span class="comment">//IIC读一个字节</span></span><br><span class="line"></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Set_Gyro_Fsr</span><span class="params">(u8 fsr)</span></span>;</span><br><span class="line"><span class="function">u8 <span class="title">MPU_Set_Accel_Fsr</span><span class="params">(u8 fsr)</span></span>;</span><br><span class="line"><span class="function">u8 <span class="title">MPU_Set_LPF</span><span class="params">(u16 lpf)</span></span>;</span><br><span class="line"><span class="function">u8 <span class="title">MPU_Set_Rate</span><span class="params">(u16 rate)</span></span>;</span><br><span class="line"><span class="function">u8 <span class="title">MPU_Set_Fifo</span><span class="params">(u8 sens)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">short</span> <span class="title">MPU_Get_Temperature</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br><span class="line"><span class="function">u8 <span class="title">MPU_Get_Gyroscope</span><span class="params">(<span class="keyword">short</span> *gx,<span class="keyword">short</span> *gy,<span class="keyword">short</span> *gz)</span></span>;</span><br><span class="line"><span class="function">u8 <span class="title">MPU_Get_Accelerometer</span><span class="params">(<span class="keyword">short</span> *ax,<span class="keyword">short</span> *ay,<span class="keyword">short</span> *az)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="number">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105</span></span><br></pre></td></tr></table></figure>
<p>MPU6050.c<br>
<strong>主要是单片机通过IIC协议向MPU6050写数据读数据的函数以及MPU6050初始化函数</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;mpu6050.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;sys.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;usart.h&quot;</span>   </span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Init</span></span><br><span class="line"><span class="comment">函数功能：初始化MPU6050</span></span><br><span class="line"><span class="comment">函数参数：无</span></span><br><span class="line"><span class="comment">函数返回值：0,初始化成功  其他,初始化失败</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">	u8 res;</span><br><span class="line">  </span><br><span class="line">	GPIO_InitTypeDef  GPIO_InitStructure;</span><br><span class="line">	</span><br><span class="line">	RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO,ENABLE);		<span class="comment">//使能AFIO时钟 </span></span><br><span class="line">	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOA,ENABLE);	<span class="comment">//先使能外设IO PORTA时钟 </span></span><br><span class="line">	</span><br><span class="line">  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_15;					  <span class="comment">//端口配置</span></span><br><span class="line">  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; 		 	<span class="comment">//推挽输出</span></span><br><span class="line">  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;		  <span class="comment">//IO口速度为50MHz</span></span><br><span class="line">  GPIO_Init(GPIOA, &amp;GPIO_InitStructure);					      <span class="comment">//根据设定参数初始化GPIOA</span></span><br><span class="line"></span><br><span class="line">	GPIO_PinRemapConfig(GPIO_Remap_SWJ_JTAGDisable,ENABLE);<span class="comment">//禁止JTAG,从而PA15可以做普通IO使用,否则PA15不能做普通IO!!!</span></span><br><span class="line">	</span><br><span class="line">	MPU_AD0_CTRL=<span class="number">0</span>;			<span class="comment">//控制MPU6050的AD0脚为低电平,从机地址为:0X68</span></span><br><span class="line">	</span><br><span class="line">	MPU_IIC_Init();			<span class="comment">//初始化IIC总线</span></span><br><span class="line">	MPU_Write_Byte(MPU_PWR_MGMT1_REG,<span class="number">0X80</span>);	<span class="comment">//复位MPU6050</span></span><br><span class="line">  delay_ms(<span class="number">100</span>);</span><br><span class="line">	MPU_Write_Byte(MPU_PWR_MGMT1_REG,<span class="number">0X00</span>);	<span class="comment">//唤醒MPU6050 </span></span><br><span class="line">	MPU_Set_Gyro_Fsr(<span class="number">3</span>);										<span class="comment">//陀螺仪传感器,±2000dps</span></span><br><span class="line">	MPU_Set_Accel_Fsr(<span class="number">0</span>);										<span class="comment">//加速度传感器,±2g</span></span><br><span class="line">	MPU_Set_Rate(<span class="number">50</span>);												<span class="comment">//设置采样率50Hz</span></span><br><span class="line">	MPU_Write_Byte(MPU_INT_EN_REG,<span class="number">0X00</span>);		<span class="comment">//关闭所有中断</span></span><br><span class="line">	MPU_Write_Byte(MPU_USER_CTRL_REG,<span class="number">0X00</span>);	<span class="comment">//I2C主模式关闭</span></span><br><span class="line">	MPU_Write_Byte(MPU_FIFO_EN_REG,<span class="number">0X00</span>);		<span class="comment">//关闭FIFO</span></span><br><span class="line">	MPU_Write_Byte(MPU_INTBP_CFG_REG,<span class="number">0X80</span>);	<span class="comment">//INT引脚低电平有效</span></span><br><span class="line">	</span><br><span class="line">	res=MPU_Read_Byte(MPU_DEVICE_ID_REG);</span><br><span class="line">	<span class="keyword">if</span>(res==MPU_ADDR)												<span class="comment">//器件ID正确,即res = MPU_ADDR = 0x68</span></span><br><span class="line">	&#123;</span><br><span class="line">		MPU_Write_Byte(MPU_PWR_MGMT1_REG,<span class="number">0X01</span>);		<span class="comment">//设置CLKSEL,PLL X轴为参考</span></span><br><span class="line">		MPU_Write_Byte(MPU_PWR_MGMT2_REG,<span class="number">0X00</span>);		<span class="comment">//加速度与陀螺仪都工作</span></span><br><span class="line">		MPU_Set_Rate(<span class="number">50</span>);													<span class="comment">//设置采样率为50Hz</span></span><br><span class="line"> 	&#125;<span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;    <span class="comment">//地址设置错误,返回1</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;					 <span class="comment">//地址设置正确,返回0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Set_Gyro_Fsr</span></span><br><span class="line"><span class="comment">函数功能：设置MPU6050陀螺仪传感器满量程范围</span></span><br><span class="line"><span class="comment">函数参数：fsr:0,±250dps;1,±500dps;2,±1000dps;3,±2000dps</span></span><br><span class="line"><span class="comment">函数返回值：0,设置成功  其他,设置失败</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Set_Gyro_Fsr</span><span class="params">(u8 fsr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> MPU_Write_Byte(MPU_GYRO_CFG_REG,fsr&lt;&lt;<span class="number">3</span>); <span class="comment">//设置陀螺仪满量程范围</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Set_Accel_Fsr</span></span><br><span class="line"><span class="comment">函数功能：设置MPU6050加速度传感器满量程范围</span></span><br><span class="line"><span class="comment">函数参数：fsr:0,±2g;1,±4g;2,±8g;3,±16g</span></span><br><span class="line"><span class="comment">函数返回值：0,设置成功  其他,设置失败</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Set_Accel_Fsr</span><span class="params">(u8 fsr)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> MPU_Write_Byte(MPU_ACCEL_CFG_REG,fsr&lt;&lt;<span class="number">3</span>); <span class="comment">//设置加速度传感器满量程范围  </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Set_LPF</span></span><br><span class="line"><span class="comment">函数功能：设置MPU6050的数字低通滤波器</span></span><br><span class="line"><span class="comment">函数参数：lpf:数字低通滤波频率(Hz)</span></span><br><span class="line"><span class="comment">函数返回值：0,设置成功  其他,设置失败</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Set_LPF</span><span class="params">(u16 lpf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u8 data=<span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(lpf&gt;=<span class="number">188</span>)data=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(lpf&gt;=<span class="number">98</span>)data=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(lpf&gt;=<span class="number">42</span>)data=<span class="number">3</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(lpf&gt;=<span class="number">20</span>)data=<span class="number">4</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span>(lpf&gt;=<span class="number">10</span>)data=<span class="number">5</span>;</span><br><span class="line">	<span class="keyword">else</span> data=<span class="number">6</span>; </span><br><span class="line">	<span class="keyword">return</span> MPU_Write_Byte(MPU_CFG_REG,data);<span class="comment">//设置数字低通滤波器  </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Set_Rate</span></span><br><span class="line"><span class="comment">函数功能：设置MPU6050的采样率(假定Fs=1KHz)</span></span><br><span class="line"><span class="comment">函数参数：rate:4~1000(Hz)  初始化中rate取50</span></span><br><span class="line"><span class="comment">函数返回值：0,设置成功  其他,设置失败</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Set_Rate</span><span class="params">(u16 rate)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u8 data;</span><br><span class="line">	<span class="keyword">if</span>(rate&gt;<span class="number">1000</span>)rate=<span class="number">1000</span>;</span><br><span class="line">	<span class="keyword">if</span>(rate&lt;<span class="number">4</span>)rate=<span class="number">4</span>;</span><br><span class="line">	data=<span class="number">1000</span>/rate<span class="number">-1</span>;</span><br><span class="line">	data=MPU_Write_Byte(MPU_SAMPLE_RATE_REG,data);	<span class="comment">//设置数字低通滤波器</span></span><br><span class="line"> 	<span class="keyword">return</span> MPU_Set_LPF(rate/<span class="number">2</span>);											<span class="comment">//自动设置LPF为采样率的一半</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Get_Temperature</span></span><br><span class="line"><span class="comment">函数功能：得到温度传感器值</span></span><br><span class="line"><span class="comment">函数参数：无</span></span><br><span class="line"><span class="comment">函数返回值：温度值(扩大了100倍)</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">short</span> <span class="title">MPU_Get_Temperature</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   u8 buf[<span class="number">2</span>]; </span><br><span class="line">   <span class="keyword">short</span> raw;</span><br><span class="line">	 <span class="keyword">float</span> temp;</span><br><span class="line">	</span><br><span class="line">	 MPU_Read_Len(MPU_ADDR,MPU_TEMP_OUTH_REG,<span class="number">2</span>,buf); </span><br><span class="line">   raw=((u16)buf[<span class="number">0</span>]&lt;&lt;<span class="number">8</span>)|buf[<span class="number">1</span>];</span><br><span class="line">   temp=<span class="number">36.53</span>+((<span class="keyword">double</span>)raw)/<span class="number">340</span>;</span><br><span class="line">   <span class="keyword">return</span> temp*<span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Get_Gyroscope</span></span><br><span class="line"><span class="comment">函数功能：得到陀螺仪值(原始值)</span></span><br><span class="line"><span class="comment">函数参数：gx,gy,gz:陀螺仪x,y,z轴的原始读数(带符号)</span></span><br><span class="line"><span class="comment">函数返回值：0,读取成功  其他,读取失败</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Get_Gyroscope</span><span class="params">(<span class="keyword">short</span> *gx,<span class="keyword">short</span> *gy,<span class="keyword">short</span> *gz)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  u8 buf[<span class="number">6</span>],res;</span><br><span class="line">	</span><br><span class="line">	res=MPU_Read_Len(MPU_ADDR,MPU_GYRO_XOUTH_REG,<span class="number">6</span>,buf);</span><br><span class="line">	<span class="keyword">if</span>(res==<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		*gx=((u16)buf[<span class="number">0</span>]&lt;&lt;<span class="number">8</span>)|buf[<span class="number">1</span>];</span><br><span class="line">		*gy=((u16)buf[<span class="number">2</span>]&lt;&lt;<span class="number">8</span>)|buf[<span class="number">3</span>];</span><br><span class="line">		*gz=((u16)buf[<span class="number">4</span>]&lt;&lt;<span class="number">8</span>)|buf[<span class="number">5</span>];</span><br><span class="line">	&#125; 	</span><br><span class="line">  <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Get_Accelerometer</span></span><br><span class="line"><span class="comment">函数功能：得到加速度值(原始值)</span></span><br><span class="line"><span class="comment">函数参数：ax,ay,az:加速度传感器x,y,z轴的原始读数(带符号)</span></span><br><span class="line"><span class="comment">函数返回值：0,读取成功  其他,读取失败</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Get_Accelerometer</span><span class="params">(<span class="keyword">short</span> *ax,<span class="keyword">short</span> *ay,<span class="keyword">short</span> *az)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    u8 buf[<span class="number">6</span>],res;  </span><br><span class="line">	res=MPU_Read_Len(MPU_ADDR,MPU_ACCEL_XOUTH_REG,<span class="number">6</span>,buf);</span><br><span class="line">	<span class="keyword">if</span>(res==<span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		*ax=((u16)buf[<span class="number">0</span>]&lt;&lt;<span class="number">8</span>)|buf[<span class="number">1</span>];  </span><br><span class="line">		*ay=((u16)buf[<span class="number">2</span>]&lt;&lt;<span class="number">8</span>)|buf[<span class="number">3</span>];  </span><br><span class="line">		*az=((u16)buf[<span class="number">4</span>]&lt;&lt;<span class="number">8</span>)|buf[<span class="number">5</span>];</span><br><span class="line">	&#125; 	</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Write_Len</span></span><br><span class="line"><span class="comment">函数功能：IIC连续写(写器件地址、寄存器地址、数据)</span></span><br><span class="line"><span class="comment">函数参数：addr:器件地址      reg:寄存器地址</span></span><br><span class="line"><span class="comment">				 len:写入数据的长度  buf:数据区</span></span><br><span class="line"><span class="comment">函数返回值：0,写入成功  其他,写入失败</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Write_Len</span><span class="params">(u8 addr,u8 reg,u8 len,u8 *buf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u8 i;</span><br><span class="line">	</span><br><span class="line">	MPU_IIC_Start();</span><br><span class="line">	MPU_IIC_Send_Byte((addr&lt;&lt;<span class="number">1</span>)|<span class="number">0</span>);      <span class="comment">//发送器件地址+写命令(0为写,1为读)	</span></span><br><span class="line">	<span class="keyword">if</span>(MPU_IIC_Wait_Ack())							 <span class="comment">//等待应答</span></span><br><span class="line">	&#123;</span><br><span class="line">		MPU_IIC_Stop();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">    MPU_IIC_Send_Byte(reg);						 <span class="comment">//写寄存器地址</span></span><br><span class="line">    MPU_IIC_Wait_Ack();		             <span class="comment">//等待应答</span></span><br><span class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;len;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		MPU_IIC_Send_Byte(buf[i]);	       <span class="comment">//发送数据</span></span><br><span class="line">		<span class="keyword">if</span>(MPU_IIC_Wait_Ack())		         <span class="comment">//等待ACK</span></span><br><span class="line">		&#123;</span><br><span class="line">			MPU_IIC_Stop();</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    MPU_IIC_Stop();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Read_Len</span></span><br><span class="line"><span class="comment">函数功能：IIC连续读(写入器件地址后,读寄存器地址、数据)</span></span><br><span class="line"><span class="comment">函数参数：addr:器件地址        reg:要读的寄存器地址</span></span><br><span class="line"><span class="comment">				 len:要读取的数据长度  buf:读取到的数据存储区</span></span><br><span class="line"><span class="comment">函数返回值：0,读取成功  其他,读取失败</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Read_Len</span><span class="params">(u8 addr,u8 reg,u8 len,u8 *buf)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">		MPU_IIC_Start();</span><br><span class="line">		MPU_IIC_Send_Byte((addr&lt;&lt;<span class="number">1</span>)|<span class="number">0</span>);		<span class="comment">//发送器件地址+写命令</span></span><br><span class="line">		<span class="keyword">if</span>(MPU_IIC_Wait_Ack())						<span class="comment">//等待应答</span></span><br><span class="line">		&#123;</span><br><span class="line">			MPU_IIC_Stop();		 </span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">    MPU_IIC_Send_Byte(reg);						<span class="comment">//写寄存器地址</span></span><br><span class="line">    MPU_IIC_Wait_Ack();								<span class="comment">//等待应答</span></span><br><span class="line">    MPU_IIC_Start();</span><br><span class="line">		MPU_IIC_Send_Byte((addr&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>);		<span class="comment">//发送器件地址+读命令	</span></span><br><span class="line">    MPU_IIC_Wait_Ack();								<span class="comment">//等待应答 </span></span><br><span class="line">		<span class="keyword">while</span>(len)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(len==<span class="number">1</span>) *buf=MPU_IIC_Read_Byte(<span class="number">0</span>);   <span class="comment">//读数据,发送nACK </span></span><br><span class="line">			<span class="keyword">else</span> 			 *buf=MPU_IIC_Read_Byte(<span class="number">1</span>);		<span class="comment">//读数据,发送ACK  </span></span><br><span class="line">			len--;</span><br><span class="line">			buf++;</span><br><span class="line">		&#125;</span><br><span class="line">    MPU_IIC_Stop();	<span class="comment">//产生一个停止条件 </span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Write_Byte</span></span><br><span class="line"><span class="comment">函数功能：IIC写一个字节</span></span><br><span class="line"><span class="comment">函数参数：data:写入的数据    reg:要写的寄存器地址</span></span><br><span class="line"><span class="comment">函数返回值：0,写入成功  其他,写入失败</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Write_Byte</span><span class="params">(u8 reg,u8 data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  MPU_IIC_Start();</span><br><span class="line">	MPU_IIC_Send_Byte((MPU_ADDR&lt;&lt;<span class="number">1</span>)|<span class="number">0</span>);<span class="comment">//发送器件地址+写命令</span></span><br><span class="line">	<span class="keyword">if</span>(MPU_IIC_Wait_Ack())						 <span class="comment">//等待应答</span></span><br><span class="line">	&#123;</span><br><span class="line">		MPU_IIC_Stop();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  MPU_IIC_Send_Byte(reg);		<span class="comment">//写寄存器地址</span></span><br><span class="line">  MPU_IIC_Wait_Ack();				<span class="comment">//等待应答</span></span><br><span class="line">	MPU_IIC_Send_Byte(data);	<span class="comment">//发送数据</span></span><br><span class="line">	<span class="keyword">if</span>(MPU_IIC_Wait_Ack())	  <span class="comment">//等待ACK</span></span><br><span class="line">	&#123;</span><br><span class="line">		MPU_IIC_Stop();</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">  MPU_IIC_Stop();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_Read_Byte</span></span><br><span class="line"><span class="comment">函数功能：IIC读一个字节</span></span><br><span class="line"><span class="comment">函数参数：reg:要读的寄存器地址</span></span><br><span class="line"><span class="comment">函数返回值：res:读取到的数据</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_Read_Byte</span><span class="params">(u8 reg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u8 res;</span><br><span class="line">	</span><br><span class="line">  MPU_IIC_Start(); </span><br><span class="line">	MPU_IIC_Send_Byte((MPU_ADDR&lt;&lt;<span class="number">1</span>)|<span class="number">0</span>);		<span class="comment">//发送器件地址+写命令	</span></span><br><span class="line">	MPU_IIC_Wait_Ack();										<span class="comment">//等待应答 </span></span><br><span class="line">  MPU_IIC_Send_Byte(reg);								<span class="comment">//写寄存器地址</span></span><br><span class="line">  MPU_IIC_Wait_Ack();										<span class="comment">//等待应答</span></span><br><span class="line">  MPU_IIC_Start();</span><br><span class="line">	MPU_IIC_Send_Byte((MPU_ADDR&lt;&lt;<span class="number">1</span>)|<span class="number">1</span>);		<span class="comment">//发送器件地址+读命令	</span></span><br><span class="line">  MPU_IIC_Wait_Ack();										<span class="comment">//等待应答 </span></span><br><span class="line">	res=MPU_IIC_Read_Byte(<span class="number">0</span>);							<span class="comment">//读取数据,发送nACK </span></span><br><span class="line">  MPU_IIC_Stop();												<span class="comment">//产生一个停止条件 </span></span><br><span class="line">	<span class="keyword">return</span> res;		</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279</span></span><br></pre></td></tr></table></figure>
<p>mpuiic.h<br>
<strong>MPU的IIC协议函数头文件，PB11为SDA，PB10为SCL。</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __MPUIIC_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __MPUIIC_H</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;sys.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//IO方向设置  ---PB11</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_SDA_IN()  &#123;GPIOB-&gt;CRH &amp;= 0XFFFF0FFF;GPIOB-&gt;CRH |= 8&lt;&lt;12;&#125;   <span class="comment">//上拉/下拉 输入模式</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_SDA_OUT() &#123;GPIOB-&gt;CRH &amp;= 0XFFFF0FFF;GPIOB-&gt;CRH |= 3&lt;&lt;12;&#125;		<span class="comment">//推挽输出  输出模式</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//IO操作函数	 </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_IIC_SCL    PBout(10) 		<span class="comment">//SCL</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_IIC_SDA    PBout(11) 		<span class="comment">//SDA	 </span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MPU_READ_SDA   PBin(11) 		<span class="comment">//输入SDA </span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//IIC所有操作函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Delay</span><span class="params">(<span class="keyword">void</span>)</span></span>;								<span class="comment">//IIC延时2ms函数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Init</span><span class="params">(<span class="keyword">void</span>)</span></span>;                <span class="comment">//初始化IIC的IO口				 </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Start</span><span class="params">(<span class="keyword">void</span>)</span></span>;								<span class="comment">//发送IIC开始信号</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Stop</span><span class="params">(<span class="keyword">void</span>)</span></span>;	  						<span class="comment">//发送IIC停止信号</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Send_Byte</span><span class="params">(u8 txd)</span></span>;					<span class="comment">//IIC发送一个字节</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_IIC_Read_Byte</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> ack)</span></span>;<span class="comment">//IIC读取一个字节</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_IIC_Wait_Ack</span><span class="params">(<span class="keyword">void</span>)</span></span>; 							<span class="comment">//IIC等待ACK信号</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Ack</span><span class="params">(<span class="keyword">void</span>)</span></span>;									<span class="comment">//IIC发送ACK信号</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_NAck</span><span class="params">(<span class="keyword">void</span>)</span></span>;								<span class="comment">//IIC不发送ACK信号</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">IMPU_IC_Write_One_Byte</span><span class="params">(u8 daddr,u8 addr,u8 data)</span></span>;</span><br><span class="line"><span class="function">u8 <span class="title">MPU_IIC_Read_One_Byte</span><span class="params">(u8 daddr,u8 addr)</span></span>;	  </span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"><span class="number">1234567891011121314151617181920212223242526272829</span></span><br></pre></td></tr></table></figure>
<p>mpuiic.c<br>
<strong>MPU的IIC协议函数编写</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;mpuiic.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;delay.h&quot;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_IIC_Delay</span></span><br><span class="line"><span class="comment">函数功能：MPU IIC延时函数，延时2ms</span></span><br><span class="line"><span class="comment">函数参数：无</span></span><br><span class="line"><span class="comment">函数返回值：无</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Delay</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	delay_us(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_IIC_Init</span></span><br><span class="line"><span class="comment">函数功能：MPU IIC初始化</span></span><br><span class="line"><span class="comment">函数参数：无</span></span><br><span class="line"><span class="comment">函数返回值：无</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Init</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;					     </span><br><span class="line">  GPIO_InitTypeDef  GPIO_InitStructure;</span><br><span class="line">	</span><br><span class="line">	RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB,ENABLE);			<span class="comment">//先使能外设IO PORTB时钟 </span></span><br><span class="line">		</span><br><span class="line">  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_10|GPIO_Pin_11;	  <span class="comment">//端口配置</span></span><br><span class="line">  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_Out_PP; 				  <span class="comment">//推挽输出</span></span><br><span class="line">  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_50MHz;				  <span class="comment">//IO口速度为50MHz</span></span><br><span class="line">  GPIO_Init(GPIOB, &amp;GPIO_InitStructure);					 					<span class="comment">//根据设定参数初始化GPIO </span></span><br><span class="line">	</span><br><span class="line">  GPIO_SetBits(GPIOB,GPIO_Pin_10|GPIO_Pin_11);						  <span class="comment">//PB10,PB11 输出高	</span></span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_IIC_Start</span></span><br><span class="line"><span class="comment">函数功能：MPU IIC发送起始信号</span></span><br><span class="line"><span class="comment">函数参数：无</span></span><br><span class="line"><span class="comment">函数返回值：无</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Start</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	MPU_SDA_OUT();     <span class="comment">//SDA线 输出</span></span><br><span class="line">	MPU_IIC_SDA=<span class="number">1</span>;	  	  </span><br><span class="line">	MPU_IIC_SCL=<span class="number">1</span>;</span><br><span class="line">	MPU_IIC_Delay();</span><br><span class="line"> 	MPU_IIC_SDA=<span class="number">0</span>;     <span class="comment">//START:当SCL线处于高电平时,SDA线突然从高变低,发送起始信号</span></span><br><span class="line">	MPU_IIC_Delay();</span><br><span class="line">	MPU_IIC_SCL=<span class="number">0</span>;		 <span class="comment">//钳住I2C总线，准备发送或接收数据 </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_IIC_Stop</span></span><br><span class="line"><span class="comment">函数功能：MPU IIC发送停止信号</span></span><br><span class="line"><span class="comment">函数参数：无</span></span><br><span class="line"><span class="comment">函数返回值：无</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Stop</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	MPU_SDA_OUT();		 <span class="comment">//SDA线输出</span></span><br><span class="line">	MPU_IIC_SCL=<span class="number">0</span>;</span><br><span class="line">	MPU_IIC_SDA=<span class="number">0</span>;		 <span class="comment">//STOP:当SCL线处于高电平时,SDA线突然从低变高,发送停止信号</span></span><br><span class="line"> 	MPU_IIC_Delay();</span><br><span class="line">	MPU_IIC_SCL=<span class="number">1</span>; </span><br><span class="line">	MPU_IIC_SDA=<span class="number">1</span>;		 <span class="comment">//发送I2C总线结束信号</span></span><br><span class="line">	MPU_IIC_Delay();							   	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_IIC_Wait_Ack</span></span><br><span class="line"><span class="comment">函数功能：MPU IIC等待信号到来</span></span><br><span class="line"><span class="comment">函数参数：无</span></span><br><span class="line"><span class="comment">函数返回值：1:接收应答信号成功  0:接收应答信号失败</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function">u8 <span class="title">MPU_IIC_Wait_Ack</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	u8 ucErrTime=<span class="number">0</span>;</span><br><span class="line">	MPU_SDA_IN();  <span class="comment">//SDA设置为输入  </span></span><br><span class="line">	MPU_IIC_SDA=<span class="number">1</span>;MPU_IIC_Delay();</span><br><span class="line">	MPU_IIC_SCL=<span class="number">1</span>;MPU_IIC_Delay();</span><br><span class="line">	<span class="keyword">while</span>(MPU_READ_SDA)</span><br><span class="line">	&#123;</span><br><span class="line">		ucErrTime++;</span><br><span class="line">		<span class="keyword">if</span>(ucErrTime&gt;<span class="number">250</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			MPU_IIC_Stop();</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	MPU_IIC_SCL=<span class="number">0</span>;<span class="comment">//时钟输出0</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_IIC_Ack</span></span><br><span class="line"><span class="comment">函数功能：MPU IIC产生应答信号</span></span><br><span class="line"><span class="comment">函数参数：无</span></span><br><span class="line"><span class="comment">函数返回值：无</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Ack</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	MPU_IIC_SCL=<span class="number">0</span>;</span><br><span class="line">	MPU_SDA_OUT();</span><br><span class="line">	MPU_IIC_SDA=<span class="number">0</span>;</span><br><span class="line">	MPU_IIC_Delay();</span><br><span class="line">	MPU_IIC_SCL=<span class="number">1</span>;</span><br><span class="line">	MPU_IIC_Delay();</span><br><span class="line">	MPU_IIC_SCL=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_IIC_NAck</span></span><br><span class="line"><span class="comment">函数功能：MPU IIC不产生应答信号</span></span><br><span class="line"><span class="comment">函数参数：无</span></span><br><span class="line"><span class="comment">函数返回值：无</span></span><br><span class="line"><span class="comment">**********************************************/</span>   </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_NAck</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	MPU_IIC_SCL=<span class="number">0</span>;</span><br><span class="line">	MPU_SDA_OUT();</span><br><span class="line">	MPU_IIC_SDA=<span class="number">1</span>;</span><br><span class="line">	MPU_IIC_Delay();</span><br><span class="line">	MPU_IIC_SCL=<span class="number">1</span>;</span><br><span class="line">	MPU_IIC_Delay();</span><br><span class="line">	MPU_IIC_SCL=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_IIC_Send_Byte</span></span><br><span class="line"><span class="comment">函数功能：MPU IIC发送一个字节</span></span><br><span class="line"><span class="comment">函数参数：txd：要发送的数据</span></span><br><span class="line"><span class="comment">函数返回值：无</span></span><br><span class="line"><span class="comment">注意：IIC发送字节是一个一个位发送的，发送一个字节需要发送八次</span></span><br><span class="line"><span class="comment">**********************************************/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">MPU_IIC_Send_Byte</span><span class="params">(u8 txd)</span></span></span><br><span class="line"><span class="function"></span>&#123;                        </span><br><span class="line">    u8 t;   </span><br><span class="line">		MPU_SDA_OUT(); 	    </span><br><span class="line">    MPU_IIC_SCL=<span class="number">0</span>;		<span class="comment">//拉低时钟开始数据传输</span></span><br><span class="line">    <span class="keyword">for</span>(t=<span class="number">0</span>;t&lt;<span class="number">8</span>;t++)</span><br><span class="line">    &#123;              </span><br><span class="line">        MPU_IIC_SDA=(txd&amp;<span class="number">0x80</span>)&gt;&gt;<span class="number">7</span>;</span><br><span class="line">        txd&lt;&lt;=<span class="number">1</span>; 	  </span><br><span class="line">		    MPU_IIC_SCL=<span class="number">1</span>;</span><br><span class="line">		    MPU_IIC_Delay(); </span><br><span class="line">		    MPU_IIC_SCL=<span class="number">0</span>;	</span><br><span class="line">		    MPU_IIC_Delay();</span><br><span class="line">    &#125;	 </span><br><span class="line">&#125; 	    </span><br><span class="line"></span><br><span class="line"><span class="comment">/**********************************************</span></span><br><span class="line"><span class="comment">函数名称：MPU_IIC_Read_Byte</span></span><br><span class="line"><span class="comment">函数功能：MPU IIC读取一个字节</span></span><br><span class="line"><span class="comment">函数参数：ack: 1,发送ACK   0,发送NACK </span></span><br><span class="line"><span class="comment">函数返回值：接收到的数据</span></span><br><span class="line"><span class="comment">注意：IIC读取字节是一个一个位读取的，读取一个字节需要读取八次</span></span><br><span class="line"><span class="comment">**********************************************/</span> </span><br><span class="line"><span class="function">u8 <span class="title">MPU_IIC_Read_Byte</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> ack)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i,receive=<span class="number">0</span>;</span><br><span class="line">  MPU_SDA_IN();              <span class="comment">//SDA设置为输入</span></span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">	  &#123;</span><br><span class="line">        MPU_IIC_SCL=<span class="number">0</span>;</span><br><span class="line">        MPU_IIC_Delay();</span><br><span class="line">				MPU_IIC_SCL=<span class="number">1</span>;</span><br><span class="line">        receive&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(MPU_READ_SDA)receive++;   <span class="comment">//如果读到了数据</span></span><br><span class="line">				MPU_IIC_Delay(); </span><br><span class="line">    &#125;					 </span><br><span class="line">    <span class="keyword">if</span> (!ack)</span><br><span class="line">        MPU_IIC_NAck();   <span class="comment">//发送nACK</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        MPU_IIC_Ack();    <span class="comment">//发送ACK   </span></span><br><span class="line">    <span class="keyword">return</span> receive;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177</span></span><br></pre></td></tr></table></figure>
<p>还有一些函数就不做过多赘述了，上面的代码备注已经做好了，认真吃肯定是会吃透的。多下点功夫肯定可以看懂。</p>
<h1>6.学习补充</h1>
<p><strong>补充1：FIFO</strong><br>
<strong>FIFO</strong>( First Input First Output)简单说就是指先进先出。由于微电子技术的飞速发展，新一代FIFO芯片容量越来越大，体积越来越小，价格越来越便宜。作为一种新型大规模集成电路，FIFO芯片以其灵活、方便、高效的特性，逐渐在高速数据采集、高速数据处理、高速数据传输以及多机处理系统中得到越来越广泛的应用。在系统设计中，以增加数据传输率、处理大量数据流、匹配具有不同传输率的系统为目的而广泛使用FIFO存储器，从而提高了系统性能。FIFO存储器是一个<strong>先入先出的双口缓冲器</strong>，即第一个进入其内的数据第一个被移出，其中一个是存储器的输入口，另一个口是存储器的输出口。对于单片FIFO来说，主要有两种结构：触发导向结构和零导向传输结构。触发导向传输结构的FIFO是由寄存器阵列构成的，零导向传输结构的FIFO是由具有读和写地址指针的双口RAM构成。详见这篇博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_26652069/article/details/90765269">FIFO工作原理</a><br>
<strong>补充2：关于PA15使用问题</strong><br>
在使用PA15作为普通IO口的时候，需要禁用JTAG才可以，代码如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RCC_APB2PeriphClockCmd(RCC_APB2Periph_AFIO,ENABLE);		<span class="comment">//使能AFIO时钟</span></span><br><span class="line">GPIO_PinRemapConfig(GPIO_Remap_SWJ_JTAGDisable,ENABLE);<span class="comment">//禁止JTAG,从而PA15可以做普通IO使用,否则PA15不能做普通IO!!!</span></span><br><span class="line"><span class="number">12</span></span><br></pre></td></tr></table></figure>
<p><strong>这是个大坑</strong><br>
<strong>补充3：关于MPU6050参考点</strong><br>
当代码烧入后，MPU的参考点是什么呢？参考点其实就是MPU6050初始化之后一开始的位置，没有一个强制的规定哪一个方向就是基准点，<strong>初始化之后的初始位置就是(0，0，0)点</strong>。<br>
<strong>补充4：想到了再写吧</strong></p>
<h1>7.效果展示(可以先来看这个)</h1>
<p><img src="https://img-blog.csdnimg.cn/20210527174024629.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xpaGFvdGlhbjExMQ==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" loading="lazy"><br>
PITCH(俯仰角)、ROLL(翻滚角)、YAW(偏航角)，单位均为 度。TEMP为当前温度，单位为摄氏度。</p>
<h1>8.参考链接</h1>
<p>[1]<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E9%99%80%E8%9E%BA%E4%BB%AA/84317?fr=aladdin">百度百科 陀螺仪</a><br>
[2]<a target="_blank" rel="noopener" href="http://www.openedv.com/docs/index.html">正点原子资料下载中心</a><br>
[3]<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/FIFO%E5%AD%98%E5%82%A8%E5%99%A8/4530258?fr=aladdin">百度百科 FIFO储存器</a><br>
[4]<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1e38ad3d4bfb">姿态角Pitch、Roll、Yaw角介绍</a></p>
<h1>9.完整版代码链接</h1>
<p><a target="_blank" rel="noopener" href="https://download.csdn.net/download/lihaotian111/19131254?spm=1001.2014.3001.5501">MPU6050模块通过OLED显示姿态角源码</a></p>
<link rel="stylesheet" href="/css/markmap.css" type="text/css"></div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="Donate" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">如果你觉得还不错的话，打赏一杯可乐如何？</div><div id="qr" style="display:none;"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/alip.jpg"><img loading="lazy" src="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/alip.jpg" alt="支付宝" title="支付宝"></a><div><span style="color:#00A3EE"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/qqp.jpg"><img loading="lazy" src="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/qqp.jpg" alt="QQ 支付" title="QQ 支付"></a><div><span style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></span></div></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/wc.png"><img loading="lazy" src="https://pic-1304932877.cos.ap-shanghai.myqcloud.com/wc.png" alt="微信支付" title="微信支付"></a><div><span style="color:#2DC100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>Post author: </strong>DarkFox</li><li class="post-copyright-link"><strong>Post link: </strong><a href="https://www.darkfox.top/posts/aff2bd6e/" title="陀螺仪--mpu6050">https://www.darkfox.top/posts/aff2bd6e/</a></li><li class="post-copyright-license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> unless otherwise stated.</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/posts/962b2335/" rel="prev" title="陀螺仪--九轴"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">陀螺仪--九轴</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/posts/262d00f8/" rel="next" title="自动调节系统"><span class="post-nav-text">自动调节系统</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>如果下方没有东西的话，请F5刷新一下！</span><br></div><div id="tcomment"></div><script src="https://cdn.jsdelivr.net/npm/twikoo@latest/dist/twikoo.all.min.js"></script><script>const twikooConfig = {"enable":true,"envId":"darkfox-9gks3bvnd1da90ed"}
twikooConfig.el = '#tcomment'
twikoo.init(twikooConfig)</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2020 – 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> DarkFox</span></div><div class="powered"><span>Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> v5.4.0</span><span class="footer-separator">|</span><span>Theme - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.5.1</span></div><div class="live_time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2020-10-03T06:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();
</script></div><div id="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv" title="Total Visitors"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-user-line"></use></svg></span><span id="busuanzi_value_site_uv"></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv" title="Total Views"><span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg></span><span id="busuanzi_value_site_pv"></span></span></div></footer><a class="hty-icon-button" id="goUp" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="Search"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script src="/js/search/local-search.js" defer></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"><input class="search-input" id="local-search-input" type="text" placeholder="Searching..." value=""></div><div id="local-search-result"></div></div><script>const date = new Date();
const today = (date.getMonth() + 1) + "-" + date.getDate()
const mourn_days = ["4-4","9-18","5-19","5-20","5-21","12-13","9-30","9-3","5-12","5-22"]
if (mourn_days.includes(today)) {
  document.documentElement.style.filter = "grayscale(1)";
}</script></div><!-- hexo injector body_end start --><script src="https://cdn.jsdelivr.net/npm/d3@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/markmap-lib@0.7.4/dist/browser/view.min.js"></script>
  <script>
      const mindmaps = document.querySelectorAll('.markmap-svg');
   
      for(const mindmap of mindmaps) {
          markmap.markmap(mindmap, JSON.parse(mindmap.innerHTML));
      }
  </script> <script src="https://cdn.jsdelivr.net/npm/hexo-tag-common@latest/js/index.js"></script><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/assets/wanko.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body></html>